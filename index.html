<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Editor — XML | D.Faleiro</title>

  <!-- SEO -->
  <meta name="description" content="Abra o XML da NF-e, ajuste custo e unidade por item e exporte uma cópia para uso interno.">

  <!-- Open Graph / WhatsApp / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Editor — XML NF-e | D.Faleiro">
  <meta property="og:description" content="Abra o XML da NF-e, ajuste custo e unidade por item e exporte uma cópia para uso interno.">
  <meta property="og:url" content="https://diogofaleiro.github.io/Editor_XML/">
  <meta property="og:image" content="https://diogofaleiro.github.io/Editor_XML/assets/og-1200x630.png">
  <meta property="og:image:secure_url" content="https://diogofaleiro.github.io/Editor_XML/assets/og-1200x630.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Xmleasy — XML NF-e | D.Faleiro">
  <meta name="twitter:description" content="Abra o XML da NF-e, ajuste custo e unidade por item e exporte uma cópia para uso interno.">
  <meta name="twitter:image" content="https://diogofaleiro.github.io/Editor_XML/assets/og-1200x630.png">

  <!-- Favicons -->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <link rel="icon" type="image/png" href="assets/favicon-32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/favicon-512.png">

  <!-- Cor da barra do navegador -->
  <meta name="theme-color" content="#0077C8">

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">

  <link rel="stylesheet" href="style.css">
</head>

<body class="big">
<header>
  <div class="title-wrap">
    <h1>Editor — XML NF-e</h1>
    <p class="desc">
      Edite <b>preço de custo</b> e <b>unidade de medida</b> por item e salve uma
      <b>cópia da NF-e alterada</b> para uso interno (sem assinatura).
    </p>
  </div>
  <div class="brand">
    <img src="assets/logo-edit-xml.png" alt="Diogo Faleiro — Editor de XML">
  </div>
</header>

<!-- Botão flutuante: Voltar ao topo -->
<button id="fabTop" class="fab-top hidden" aria-label="Voltar ao topo">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
    <path d="M12 19V5M12 5l-5 5M12 5l5 5"
          stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  Topo
</button>


<main>
  <div class="panel">
    <div id="dropzone" class="row"
         onclick="document.getElementById('file').click()"
         ondragover="evtDragOver(event)" ondragleave="evtDragLeave(event)" ondrop="evtDrop(event)">
      <div class="grow">
        <b>Abra um XML da NF-e</b><br>
        <span class="help">Clique aqui ou arraste o arquivo .xml. Suporta &lt;nfeProc&gt; e &lt;NFe&gt; (v4.00).</span>
      </div>

      <!-- Botão Importar XML -->
      <div class="import-wrap">
        <span id="btnImportXML" class="btn-import">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 16V4m0 0l-4 4m4-4l4 4M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2"
                  stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Importar XML
        </span>
      </div>
    </div>

      <!-- input com fallback de leitura -->
      <input id="file" type="file" accept=".xml"
             onchange="if (this.files && this.files[0]) loadXMLFile(this.files[0])">
    </div>

    <!-- Indicador de carregamento -->
    <div id="loading" class="loading hidden">Carregando XML…</div>

    <!-- Metadados -->
    <div id="meta" class="info hidden" aria-live="polite"></div>

    <!-- CNPJ destinatário -->
    <div id="cnpjWrap" class="panel hidden cnpj-card">
      <label for="cnpjDest" class="cnpj-label">CNPJ do destinatário:</label>
      <input id="cnpjDest" type="text" inputmode="numeric" placeholder="00.000.000/0000-00" class="cnpj-input">
      <small id="cnpjHint" class="help cnpj-hint">Digite 14 dígitos.</small>
    </div>

    <!-- Toolbar -->
    <div class="toolbar hidden" id="toolbar">
      <button onclick="exportAlteredNFeXML()">Salvar XML alterado (uso interno)</button>
     <button class="secondary" onclick="limparComEfeito()">Limpar</button>
      <div class="spacer"></div>
      <div class="sum" id="somaCustos"></div>
    </div>
    <!-- Ações em massa -->
<!-- Ações em massa (oculto até carregar um XML) -->
<div id="bulkBar" class="row hidden sticky-bar" style="margin-top:8px; gap:8px;">
  <select id="bulkScope">
    <option value="selected">Itens selecionados</option>
    <option value="all">Todos os itens</option>
  </select>
  <input id="bulkNewUnit" type="text" maxlength="6"
         placeholder="Nova unidade (ex.: UN, PC, CX)">
  <button id="btnBulkApply" class="secondary">Aplicar unidade</button>
</div>

    <!-- Tabela -->
    <div id="tableWrap" class="hidden">
      <table id="tbl">
<thead>
    <tr>
    <!-- Checkbox mestre para selecionar/deselecionar todas as linhas -->
    <th style="width:36px; text-align:center;">
      <input type="checkbox" id="selectAllRows" aria-label="Selecionar todos">
    </th>
    <th>Código</th>
    <th>Descrição</th>
    <th class="ucom">Unid.</th>
    <th>Qtd</th>
    <th>Vlr Unit. NF-e</th>
    <th>Vlr Total NF-e</th>
    <th class="costCol">Preço de Custo (unit.)</th>
    <th>Custo Total</th>
  </tr>
</thead>

        <tbody id="tbody"></tbody>
      </table>
      <div class="foot">
        Dica: altere <i>Preço de Custo (unit.)</i> e, se necessário, a <i>Unid.</i>. O total é calculado (Qtd × Custo).
      </div>
    </div>
  </div>

  <p class="help warn">
    ⚠️ Alterar um XML de NF-e autorizado invalida a assinatura. O arquivo salvo aqui é apenas para
    <b>uso interno</b> (importe no seu sistema), <b>não</b> é documento fiscal.
  </p>
</main>

<footer>
  By <b>Diogo Faleiro</b> — © 2025
</footer>

<script src="script.js" defer></script>

<!-- Modal de notificação de instalação -->
<div id="installModal" class="install-modal">
  <div class="install-modal-content">
    <p>Gostaria de adicionar este aplicativo à sua tela inicial?</p>
    <button id="installBtn" class="install-btn">Sim, adicionar a área de trabalho</button>
    <button id="dismissBtn" class="dismiss-btn">Não, obrigado</button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Registro do Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/Editor_XML/sw.js')  // Caminho correto para a subpasta
          .then((registration) => {
            console.log('Service Worker registrado com sucesso:', registration);
          })
          .catch((error) => {
            console.log('Falha ao registrar o Service Worker:', error);
          });
      });
    }

    // Função renderTable() chamada após o carregamento do DOM
    renderTable();
  });
</script>

</body>
</html>